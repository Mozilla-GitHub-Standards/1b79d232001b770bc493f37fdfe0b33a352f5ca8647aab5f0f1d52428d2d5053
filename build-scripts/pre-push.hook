#!/bin/bash
set -e

# Copy this hook to the .git/hooks directory to build
# the Jekyll site and publish it to gh-pages when
# attempting to push to master.

remote="$1"

while read local_ref local_sha remote_ref remote_sha
do
    build_msg="Building Jekyll site for commit $local_sha"
    ./build-scripts/build-gh-pages "$build_msg"

    echo "Pushing to gh-pages..."
    git push --no-verify "$remote" "gh-pages"
    git checkout -
done

exit 0
